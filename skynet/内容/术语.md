[TOC]



##### skynet

是一个为网络游戏服务器设计的轻量框架。



##### 服务器(节点)

- 一个基于 skynet 框架开发的服务器，是由若干服务构成。
- 单个 skynet 节点仅使用一个操作系统进程。
- 服务间的通讯是在进程内完成的。



##### 服务

- 每个 skynet 服务都依赖一个 `skynet_context` 的 C 对象，它是由 snlua 导入到 lua 虚拟机中的。
- 你只需要编写一个后缀为 .lua 的脚本文件，把文件名作为启动参数，启动 snlua 即可。
- 每个 skynet 服务，最重要的职责就是处理别的服务发送过来的消息，以及向别的服务发送消息。
- 在同一个 lua 虚拟机（同一个 lua 服务）中，永远不可能出现多线程并发的情况。



##### 消息

每条 skynet 消息由五个元素构成。

1. **session消息标识**

   session 是由发起请求的服务生成的，对它自己唯一的消息标识。

   session 是一个非负整数，当一条消息不需要回应时，按惯例，使用 0 这个特殊的 session 号。

2. **source消息源**

   每个服务都由一个 32bit 整数标识。

   高 8bit 表明了它所属的节点。

3. **type消息类别**

   最常用的消息类别名为 "lua" 广泛用于用 lua 编写的 skynet 服务间的通讯。

4. **message消息的 C 指针**

   在 Lua 层看来是一个 lightuserdata。

   框架会隐藏这个细节，最终用户处理的是经过解码过的 lua 对象。

5. **size消息的长度** 

   通常和 message 一起结合起来使用。



**消息序列化**

当我们能确保消息仅在同一进程间流通的时候，便可以直接把 C 对象编码成一个指针。因为进程相同，所以 C 指针可以有效传递。但是，skynet 默认支持有多节点模式，消息有可能被传到另一台机器的另一个进程中。这种情况下，每条消息都必须是一块连续内存，我们就必须对消息进行序列化操作。

